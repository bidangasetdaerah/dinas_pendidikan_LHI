// Fungsi animasi angka
function animateNumber(element, start, end, duration) {
  let startTime = null;
  function step(currentTime) {
    if (!startTime) startTime = currentTime;
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = Math.floor(progress * (end - start) + start);
    element.textContent =
      "ðŸ’° Jumlah Total Nilai Perolehan (hasil filter): " + formatRupiah(value);
    if (progress < 1) {
      requestAnimationFrame(step);
    }
  }
  requestAnimationFrame(step);
}

function renderTable() {
  tbody.innerHTML = "";
  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = filteredData.slice(start, end);

  pageData.forEach((row) => {
    const tr = document.createElement("tr");
    tr.classList.add("hover:bg-gray-50", "dark:hover:bg-gray-700");

    const full = padRow(row, 23);
    full.forEach((cell, index) => {
      const td = document.createElement("td");
      td.className = "border p-2 align-top";
      if (index === 13 || index === 14) {
        td.textContent = formatRupiah(cell);
      } else {
        td.textContent = cell ?? "";
      }
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  pageInfo.textContent = `Halaman ${currentPage} dari ${Math.max(
    1,
    Math.ceil(filteredData.length / rowsPerPage)
  )}`;

  // === Hitung total kolom Nilai Perolehan (index 14) ===
  const totalNilai = filteredData.reduce((sum, row) => {
    const val = parseFloat((row[14] || "").toString().replace(/[^\d.-]/g, ""));
    return sum + (isNaN(val) ? 0 : val);
  }, 0);

  const totalContainer = document.getElementById("totalContainer");

  // Ambil nilai lama (biar animasi dari angka sebelumnya)
  const oldValue = parseFloat(
    totalContainer.getAttribute("data-value") || "0"
  );

  // Simpan nilai baru ke atribut
  totalContainer.setAttribute("data-value", totalNilai);

  // Jalankan animasi
  animateNumber(totalContainer, oldValue, totalNilai, 800);
}
